
**Part 1: Installation and Configuration**

### Install Chef Workstation : 

- Visit the Chef Workstation download page (https://downloads.chef.io/tools/workstation) and install Chef Workstation on your local machine.

### Set Up a Chef Repository:

1. **Create a New Directory** :
	- Use the `mkdir` command to create a new directory. 
	- For example :`mkdir chef-repo1`
 
2. **Change Directory** :
	- Go into the newly created directory.
	- For example : `cd chef-repo1`

3. **Initialize Chef Repository** :
	- Use the `chef` command-line tool to generate a new Chef repository.
	- For example : `chef generate repo example-repo`
	- This command initializes a new Chef repository in the current directory `example_repo`. It generates the necessary directory structure and configuration files for a basic Chef repository.

4. **Verify Repository Creation**:
	- Check the contents of the directory to ensure the Chef repository was created successfully.
	- Ex :- `ls -l
	- You should see folders and files generated by Chef, including directories like `cookbooks`, `roles`, `data_bags`, etc., along with some configuration files.
![[Screenshot from 2023-11-28 11-30-38.png]]

### Configure Chef Workstation:

1. **Navigate to Your Chef Repository Directory**:
    
    - For example :  `cd chef-repo1`

2. **Create/Edit `config.rb`**:
    
    - You can create a new `config.rb` file if it doesn't exist or edit it if it's already there. Use a text editor like Nano or Vim based on your system.
    
    For example, using a command-line text editor like Nano:
    `nano config.rb`
    
3. **Configure `config.rb` for Chef Server**:
    
    - In the `config.rb` file, you'll set the configuration for your Chef Server.
    - syntax : 
    
    `current_dir = File.dirname(__FILE__)  
    chef_server_url 'https://YOUR_CHEF_SERVER_URL/organizations/YOUR_ORG_NAME' 
    node_name 'YOUR_NODE_NAME' 
    client_key "#{current_dir}/YOUR_CLIENT_KEY_NAME.pem" validation_client_name 'YOUR_ORG_NAME-validator' 
    validation_key "#{current_dir}/YOUR_ORG_NAME-validator.pem"`
    
    Replace the placeholders:
    
    - `YOUR_CHEF_SERVER_URL` with your Chef Server's URL.
    - `YOUR_ORG_NAME` with your organization name.
    - `YOUR_NODE_NAME` with your node's name or the name you wish to use.
    - `YOUR_CLIENT_KEY_NAME.pem` with the name of your client key file (usually your node name).
    - `YOUR_ORG_NAME-validator.pem` with the name of your validation key file.

**example**

current_dir = File.dirname(__FILE__)
chef_server_url 'https://chef-server/organizations/relevance'
node_name 'sanjaykumar'
client_key "#{current_dir}/sanjaykumar.pem"
validation_client_name 'relevance-validator'
validation_key "#{current_dir}/relevance-validator.pem"

![[Screenshot from 2023-11-28 12-49-30.png]]

**Test Your Configuration** :

Running `knife client list` helps verify if your Chef Workstation can communicate with the Chef Server and if the configurations are set correctly. Here's how to execute the command:

Ex:-  `sudo knife client list`

![[Screenshot from 2023-11-28 12-49-06.png]]

**Part 2: Creating a Basic Recipe**

1. **Create a New Cookbook** :
	- synatx for creating a cookbook :- `chef generate cookbook cookbook_name`
	- Ex:- **sudo chef generate cookbook my_cookbook**
	- it will create a new cookbook called `my_cookbook` inside the repository.

![[Screenshot from 2023-11-28 13-35-12.png]]

2. **Write a Recipe and upload the cookbook** :

- Let's create a basic recipe by using `chef generate recipe example-recipe` that creates a recipe file within our cookbook and then upload the cookbook to the Chef Server using the `knife cookbook upload` command.

Navigate to our cookbook's `recipes` directory and edit a file named `example-recipe.rb` with the following content:

`# my_cookbook/recipes/example-recipe.rb`  
**file '/tmp/example_file.txt' do
content 'This is an example file of Chef!'   
action :create 
end**

This recipe uses Chef's `file` resource to create a file named `example_file.txt` in the `/tmp` directory with the specified content.

After saving the recipe file, ensure you are in the parent directory of our cookbook and execute the following command to upload your cookbook to the Chef Server:

**knife cookbook upload my_cookbook**

- This command will upload the cookbook to the chef server.

![[Screenshot from 2023-11-28 16-08-22.png]]

**Part 3: Applying the Recipe**

1. **Bootstrap a Target Node** :

	- `knife bootstrap` command will install the Chef client on the target node and configure it to communicate with your Chef Server.

Here's the general syntax for the `knife bootstrap` command:

`knife bootstrap TARGET_NODE_IP_OR_HOSTNAME -x USERNAME -P PASSWORD --sudo -N NODE_NAME --run-list 'recipe[COOKBOOK_NAME]'`

Replace the required names:

- `TARGET_NODE_IP_OR_HOSTNAME`: The IP address or hostname of the target node.
- `USERNAME`: The username to connect to the target node (for SSH access).
- `PASSWORD`: The password for the specified username.
- `NODE_NAME`: The name you want to assign to the node in the Chef Server.
- `COOKBOOK_NAME`: The name of the cookbook you want to apply to the node.

**For Example :- 
sudo knife bootstrap 192.168.122.249 -P Sanjay@1180 -x rle1180 -N chef-node2 --sudo --use-sudo-password -r 'recipe[my_cookbook::example-recipe]'**

2. **Apply the Recipe** :

To apply the recipe to the target node using the `chef-client` command:

- Execute the `chef-client` command specifying the recipe or run list you want to apply to the node. For instance, if your recipe is `example-recipe.rb` located in the `my_cookbook` cookbook's `recipes` directory,  then run the below command:

**sudo chef-client --runlist 'recipe[my_cookbook::example-recipe]'**
